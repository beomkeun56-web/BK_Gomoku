<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BK GOMOKU : 3D Premium</title>
<style>
  /* 1. ë ˆì´ì•„ì›ƒ & ë°°ê²½ */
  body {
    background-color: #1a1a1a; /* ë°°ê²½ì„ ë” ì–´ë‘¡ê²Œ í•˜ì—¬ ë°”ë‘‘íŒ ê°•ì¡° */
    background-image: radial-gradient(circle at 50% 30%, #2a2a2a, #000);
    color: #fff; margin: 0; padding: 10px 0;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    min-height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    touch-action: manipulation; box-sizing: border-box;
  }

  header { 
    width: 92vw; max-width: 450px; margin-bottom: 20px; 
    display: flex; flex-direction: column; align-items: center; padding-top: 15px;
  }
  
  h1 { 
    margin: 0 0 5px 0; font-size: 2.4rem; color: #d4af37; /* ê¸ˆìƒ‰ í…ìŠ¤íŠ¸ */
    letter-spacing: 3px; text-transform: uppercase; font-weight: 300; 
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }
  
  #status { 
    font-weight: 700; font-size: 1.4rem; color: #eee;
    margin-bottom: 5px; display: flex; align-items: center; justify-content: center; gap: 8px;
    background: rgba(255,255,255,0.1); padding: 8px 20px; border-radius: 30px;
    backdrop-filter: blur(5px); box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  .turn-indicator { font-size: 0.9rem; color: #bbb; font-weight: normal; }
  .opponent-rank {
    font-size: 0.85rem; color: #FFD700; font-weight: normal; opacity: 0.9;
    margin-left: 5px; padding-left: 10px; border-left: 1px solid #555;
  }

  .hidden { display: none !important; }

  /* 2. ë©”ë‰´ í™”ë©´ */
  #menu { 
    background: linear-gradient(145deg, #222, #111); padding: 40px 25px; border-radius: 20px; 
    border: 1px solid #333; margin-top: 5vh;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6); 
    text-align: center; width: 90%; max-width: 380px; 
  }
  .option-group { margin-bottom: 30px; }
  .option-title { font-weight: 600; margin-bottom: 15px; display: block; color: #aaa; font-size: 0.95rem; letter-spacing: 1px; }
  
  .color-group { display: flex; justify-content: center; gap: 12px; }
  .level-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }

  .choice-btn { 
    padding: 14px 0; border: 1px solid #444; 
    background: #2a2a2a; color: #888;
    cursor: pointer; border-radius: 12px; 
    font-size: 0.95rem; font-weight: 600; transition: all 0.2s ease; 
  }
  .choice-btn.selected { 
    border-color: #d4af37; background: #d4af37; color: #000; 
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); transform: translateY(-2px);
  }
  
  #start-btn { 
    width: 100%; padding: 18px; 
    background: linear-gradient(135deg, #d4af37, #aa8c2c); color: #000; 
    border: none; border-radius: 15px; 
    font-size: 1.2rem; font-weight: 800; cursor: pointer; 
    box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3); margin-top: 10px;
    touch-action: manipulation; transition: transform 0.1s;
  }
  #start-btn:active { transform: scale(0.97); }

  /* 3. 3D ë°”ë‘‘íŒ (í•µì‹¬ ë””ìì¸) */
  #game-wrapper {
    position: relative; width: 92vw; height: 92vw;
    max-width: 450px; max-height: 450px;
    /* ë¦¬ì–¼ ìš°ë“œ í…ìŠ¤ì²˜ íš¨ê³¼ */
    background-color: #e6c288;
    background-image: 
        linear-gradient(45deg, rgba(0,0,0,0.03) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.03) 75%, rgba(0,0,0,0.03)), 
        linear-gradient(45deg, rgba(0,0,0,0.03) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.03) 75%, rgba(0,0,0,0.03));
    background-size: 20px 20px;
    background-position: 0 0, 10px 10px;
    
    border: 8px solid #8b5a2b; /* ë‚˜ë¬´ í”„ë ˆì„ */
    border-radius: 4px;
    box-shadow: 
        inset 0 0 20px rgba(0,0,0,0.2), /* ë‚´ë¶€ ê·¸ë¦¼ì */
        0 20px 50px rgba(0,0,0,0.6); /* ì™¸ë¶€ ê·¸ë¦¼ì */
    margin-bottom: 25px; 
  }

  /* ê²©ì ë¼ì¸ (ë” ì„ ëª…í•˜ê²Œ) */
  .line { position: absolute; background-color: #2c1e12; pointer-events: none; opacity: 0.8; }
  .h-line { height: 1px; left: 5%; right: 5%; } /* ëë¶€ë¶„ ì‚´ì§ ë„ì›€ */
  .v-line { width: 1px; top: 5%; bottom: 5%; }
  
  /* í™”ì  (ì‘ê³  ì§„í•˜ê²Œ) */
  .dot { 
    position: absolute; width: 6px; height: 6px; 
    background: #2c1e12; border-radius: 50%; 
    transform: translate(-50%, -50%); pointer-events: none; 
    box-shadow: 0 1px 1px rgba(255,255,255,0.2);
  }
  .click-area { position: absolute; transform: translate(-50%, -50%); z-index: 10; cursor: pointer; }

  /* 4. 3D ë°”ë‘‘ëŒ ë””ìì¸ (í•˜ì´ë¼ì´íŠ¸ & ê·¸ë¦¼ì) */
  .stone { 
    position: absolute; border-radius: 50%; 
    transform: translate(-50%, -50%); z-index: 20; 
    pointer-events: none; 
    /* ëŒ ê·¸ë¦¼ì (ì…ì²´ê°ì˜ í•µì‹¬) */
    box-shadow: 2px 3px 5px rgba(0,0,0,0.5), inset -2px -2px 5px rgba(0,0,0,0.2);
  }
  
  /* í‘ëŒ: ë§¤íŠ¸í•œ ë¸”ë™ + ìƒë‹¨ ê´‘ì› */
  .stone.black { 
    background: radial-gradient(circle at 35% 35%, #555, #111 20%, #000 80%);
  }
  
  /* ë°±ëŒ: ë¶€ë“œëŸ¬ìš´ í™”ì´íŠ¸ + ìƒë‹¨ ê´‘ì› */
  .stone.white { 
    background: radial-gradient(circle at 35% 35%, #fff, #eee 30%, #ccc 80%);
  }

  /* ë§ˆì§€ë§‰ ìˆ˜ í‘œì‹œ (ë¶‰ì€ ë³´ì„ ëŠë‚Œ) */
  .last-move::after { 
    content: ''; position: absolute; top: 50%; left: 50%; width: 20%; height: 20%; 
    border-radius: 50%; transform: translate(-50%, -50%); 
    background-color: #ff3b30; 
    box-shadow: 0 0 8px #ff0000;
  }

  /* í›ˆìˆ˜ ë§ˆì»¤ */
  .hint-marker {
    position: absolute; 
    border: 2px solid rgba(0,0,0,0.5); 
    background: rgba(255, 215, 0, 0.3);
    border-radius: 50%; transform: translate(-50%, -50%); z-index: 15;
    pointer-events: none; box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
  }

  /* 5. í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë°” */
  .control-bar {
    width: 92vw; max-width: 450px;
    display: flex; justify-content: space-between; gap: 12px; margin-bottom: 15px;
  }
  .game-btn {
    flex: 1; padding: 16px 0; border-radius: 12px;
    font-size: 1.05rem; font-weight: 700;
    cursor: pointer; transition: all 0.15s;
    display: flex; justify-content: center; align-items: center; gap: 6px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  
  #hint-btn { 
    background: #333; border: 1px solid #d4af37; color: #d4af37; 
  }
  #hint-btn:active { background: #d4af37; color: #000; transform: translateY(2px); }
  
  #undo-btn { 
    background: #2c2c2e; border: 1px solid #555; color: #eee; 
  }
  #undo-btn:active { background: #eee; color: #000; transform: translateY(2px); }
  
  #exit-btn {
    width: 92vw; max-width: 450px; padding: 14px 0;
    background: transparent; border: 1px solid #444; color: #888;
    border-radius: 12px; font-size: 0.9rem; cursor: pointer; font-weight: 500;
    margin-bottom: 20px;
  }
  #exit-btn:active { background: #333; color: #fff; }

</style>
</head>
<body>

<div id="menu">
  <h1>BK GOMOKU</h1>
  <p style="color:#666; font-size:0.8rem; margin-bottom:30px;">PREMIUM 3D EDITION</p>
  
  <div class="option-group">
    <span class="option-title">ë‚´ ëŒ ì„ íƒ</span>
    <div class="color-group">
      <button class="choice-btn selected" style="flex:1;" onclick="setOpt('color','black',this)">í‘(â—)</button>
      <button class="choice-btn" style="flex:1;" onclick="setOpt('color','white',this)">ë°±(â—‹)</button>
    </div>
  </div>

  <div class="option-group">
    <span class="option-title">AI ë‚œì´ë„</span>
    <div class="level-grid">
      <button class="choice-btn" onclick="setOpt('level',1,this)">1ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',2,this)">2ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',3,this)">3ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',4,this)">4ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',5,this)">5ë“±ê¸‰</button>
      <button class="choice-btn selected" onclick="setOpt('level',6,this)">6ë“±ê¸‰</button>
    </div>
  </div>
  
  <button id="start-btn" onclick="startGame()" ontouchstart="startGame()">ëŒ€êµ­ ì‹œì‘</button>
</div>

<div id="game" class="hidden">
  <header>
    <h1>BK GOMOKU</h1>
    <div id="status"></div>
  </header>

  <div id="game-wrapper"></div>

  <div class="control-bar">
    <button id="hint-btn" class="game-btn" onclick="showHint()">âœ¨ í›ˆìˆ˜ ë³´ê¸°</button>
    <button id="undo-btn" class="game-btn" onclick="undoMove()">â†© ë¬´ë¥´ê¸°</button>
  </div>
  <button id="exit-btn" onclick="goBackToMenu()">ë©”ë‰´ë¡œ ë‚˜ê°€ê¸°</button>
</div>

<script>
  // [ë¡œì§ì€ ê¸°ì¡´ Human-like Balance ë²„ì „ê³¼ ë™ì¼]
  const SIZE = 15;
  const PADDING = 5.0; // 3D ë³´ë“œëŠ” ì—¬ë°±ì„ ì¡°ê¸ˆ ë” ì¤Œ
  const ACTIVE_WIDTH = 100 - (PADDING * 2);
  const STEP = ACTIVE_WIDTH / (SIZE - 1);
  const STONE_SIZE = STEP * 0.9; // ëŒ í¬ê¸°ë¥¼ ì‚´ì§ í‚¤ì›Œ ì…ì²´ê° ê°•ì¡°

  let boardData = [], myColor = 'black', aiColor = 'white', level = 6, currPlayer = 'black', gameOver = false;
  let moveHistory = []; 
  let aiTimer = null;   
  let audioCtx = null;

  function initAudio() {
    try {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
    } catch(e) {}
  }

  function playClickSound() {
    try {
      if (!audioCtx) return; 
      const bufferSize = audioCtx.sampleRate * 0.1; 
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      // ì†Œë¦¬ë¥¼ ì¡°ê¸ˆ ë” ë‘”íƒí•˜ê²Œ(ë‚˜ë¬´ì— ëŒ ë†“ëŠ” ì†Œë¦¬ í‰ë‚´) í•„í„° ì¡°ì •
      const filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = 800; 
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.08);
      noise.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
      noise.start();
    } catch(e) {}
  }

  const wrapper = document.getElementById('game-wrapper');
  const statusEl = document.getElementById('status');
  const menuEl = document.getElementById('menu');
  const gameEl = document.getElementById('game');

  function getPos(idx) { return PADDING + (idx * STEP); }

  function setOpt(type, val, btn) {
    if(window.event) window.event.stopPropagation();
    if(type==='color') { myColor=val; aiColor=(val==='black'?'white':'black'); }
    if(type==='level') level = parseInt(val);
    let container = btn.parentElement;
    container.querySelectorAll('.choice-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
  }

  function startGame() {
    if(window.event) window.event.preventDefault();
    initAudio();

    menuEl.classList.add('hidden');
    gameEl.classList.remove('hidden');
    boardData = Array(SIZE).fill(null).map(() => Array(SIZE).fill(null));
    wrapper.innerHTML = '';
    
    currPlayer = 'black'; 
    gameOver = false; 
    moveHistory = []; 
    if(aiTimer) clearTimeout(aiTimer);
    
    updateStatus();

    // ê²©ì ê·¸ë¦¬ê¸°
    for(let i=0; i<SIZE; i++) {
      let pos = getPos(i) + '%';
      let h = document.createElement('div'); h.className='line h-line'; h.style.top=pos; wrapper.appendChild(h);
      let v = document.createElement('div'); v.className='line v-line'; v.style.left=pos; wrapper.appendChild(v);
    }
    // í™”ì  (3, 7, 11)
    [3, 7, 11].forEach(r => [3, 7, 11].forEach(c => {
      let dot = document.createElement('div'); dot.className='dot';
      dot.style.top=getPos(r)+'%'; dot.style.left=getPos(c)+'%'; wrapper.appendChild(dot);
    }));
    // í´ë¦­ ì˜ì—­
    for(let r=0; r<SIZE; r++) {
      for(let c=0; c<SIZE; c++) {
        let area = document.createElement('div'); area.className='click-area';
        area.style.width = STEP + '%'; area.style.height = STEP + '%';
        area.style.top=getPos(r)+'%'; area.style.left=getPos(c)+'%';
        area.onclick = () => userMove(r, c);
        wrapper.appendChild(area);
      }
    }
    
    if(myColor === 'white') {
        aiTimer = setTimeout(aiMove, 600);
    }
  }

  function goBackToMenu() {
    gameEl.classList.add('hidden'); menuEl.classList.remove('hidden'); wrapper.innerHTML = '';
  }

  function userMove(r, c) {
    if(gameOver || currPlayer !== myColor || boardData[r][c]) return;
    placeStone(r, c, myColor);
    removeHint();
    if(!gameOver) { 
      currPlayer = aiColor; updateStatus(); 
      aiTimer = setTimeout(aiMove, 500); 
    }
  }

  function placeStone(r, c, color) {
    boardData[r][c] = color;
    let prevLast = document.querySelector('.last-move');
    if(prevLast) prevLast.classList.remove('last-move');
    
    let stone = document.createElement('div');
    stone.className = `stone ${color} last-move`;
    stone.style.width = STONE_SIZE + '%';
    stone.style.height = STONE_SIZE + '%';
    stone.style.top = getPos(r) + '%';
    stone.style.left = getPos(c) + '%';
    wrapper.appendChild(stone);
    
    moveHistory.push({r, c, color, el: stone});
    playClickSound();
    
    if(checkWin(r, c, color)) {
      gameOver = true;
      let winText = (color==='black'?"í‘(â—) ìŠ¹ë¦¬!":"ë°±(â—‹) ìŠ¹ë¦¬!");
      // ìŠ¹ë¦¬ ë©”ì‹œì§€ë„ ê³ ê¸‰ìŠ¤ëŸ½ê²Œ
      statusEl.innerHTML = `<span style="color:#d4af37; text-shadow:0 0 10px gold;">ğŸ† ${winText}</span>`;
      setTimeout(()=>alert(winText), 200);
    }
  }

  function aiMove() {
    if(gameOver) return;
    let bm = computeBestMove(aiColor, level); 
    placeStone(bm.r, bm.c, aiColor);
    if(!gameOver) { currPlayer = myColor; updateStatus(); }
  }

  function undoMove() {
    if(moveHistory.length === 0) return;
    if(aiTimer) clearTimeout(aiTimer);
    removeHint(); gameOver = false;
    
    let lastMove = moveHistory[moveHistory.length-1];
    if (lastMove.color === aiColor) { 
        popStone(); 
        if(moveHistory.length > 0) popStone(); 
    } else { 
        popStone(); 
    }
    
    currPlayer = myColor; updateStatus();
    
    let prevLast = document.querySelector('.last-move');
    if(prevLast) prevLast.classList.remove('last-move'); 
    if(moveHistory.length > 0) {
        moveHistory[moveHistory.length-1].el.classList.add('last-move');
    }
  }

  function popStone() {
    let item = moveHistory.pop();
    boardData[item.r][item.c] = null; 
    item.el.remove(); 
  }

  function showHint() {
    if(gameOver) return;
    removeHint();
    let best = computeBestMove(currPlayer, 0); // 0 = í›ˆìˆ˜ (God Mode)
    let marker = document.createElement('div');
    marker.className = 'hint-marker';
    marker.style.width = STONE_SIZE + '%';
    marker.style.height = STONE_SIZE + '%';
    marker.style.top = getPos(best.r) + '%';
    marker.style.left = getPos(best.c) + '%';
    wrapper.appendChild(marker);
  }

  function removeHint() {
    let exist = document.querySelector('.hint-marker');
    if(exist) exist.remove();
  }

  function getLineStr(r, c, dr, dc, color) {
    let str = "";
    for(let k=-4; k<=4; k++) {
      let nr = r + dr*k, nc = c + dc*k;
      if(nr<0||nr>=SIZE||nc<0||nc>=SIZE) str += "2"; 
      else {
        let val = boardData[nr][nc];
        if(val === null) str += "0";
        else if(val === color) str += "1";
        else str += "2"; 
      }
    }
    return str;
  }

  // [AI ë¡œì§ ìœ ì§€: Human-like]
  function computeBestMove(atkColor, lv) {
    let defColor = (atkColor === 'black' ? 'white' : 'black');
    let maxS = -Infinity, cands = [];
    let center = 7;

    let defW = 1.0; 
    
    switch(lv) {
        case 0: defW = 1.5; break; 
        case 1: defW = 1.0; break; 
        case 2: defW = 0.8; break; 
        case 3: defW = 0.6; break; 
        case 4: defW = 0.4; break; 
        case 5: defW = 0.2; break; 
        case 6: defW = 0.05; break; // ë°©ì–´ ê±°ì˜ ì•ˆí•¨
    }

    for(let r=0; r<SIZE; r++) {
      for(let c=0; c<SIZE; c++) {
        if(boardData[r][c]) continue;
        
        let atkScore = getPatternScore(r, c, atkColor);
        let defScore = getPatternScore(r, c, defColor);
        
        let total = atkScore + (defScore * defW); 
        total -= (Math.abs(r-center) + Math.abs(c-center)); 

        if(lv !== 0) total += Math.random() * 5; 

        if(total > maxS) { maxS=total; cands=[{r,c}]; }
        else if(total === maxS) cands.push({r,c});
      }
    }
    return cands.length ? cands[Math.floor(Math.random()*cands.length)] : {r:7,c:7};
  }

  function getPatternScore(r, c, stoneColor) {
    let totalScore = 0;
    const directions = [[0,1], [1,0], [1,1], [1,-1]];
    directions.forEach(d => {
      let lineStr = getLineStr(r, c, d[0], d[1], stoneColor);
      if(lineStr.includes("11111")) totalScore += 100000000;
      else if(lineStr.includes("011110")) totalScore += 10000000;
      else if(lineStr.includes("01111") || lineStr.includes("11110")) totalScore += 500000;
      else if(lineStr.includes("01110") || lineStr.includes("010110") || lineStr.includes("011010")) totalScore += 200000;
      else if(lineStr.includes("1110") || lineStr.includes("0111")) totalScore += 5000;
      else if(lineStr.includes("0110") || lineStr.includes("01010")) totalScore += 3000;
      else if(lineStr.includes("11")) totalScore += 100;
    });
    return totalScore;
  }

  function checkWin(r, c, color) {
    return [[0,1],[1,0],[1,1],[1,-1]].some(d => {
      let cnt = 1;
      for(let k=1; k<6; k++) if(isValid(r+d[0]*k, c+d[1]*k, color)) cnt++; else break;
      for(let k=1; k<6; k++) if(isValid(r-d[0]*k, c-d[1]*k, color)) cnt++; else break;
      return cnt >= 5;
    });
  }
  function isValid(r, c, color) { return r>=0 && r<SIZE && c>=0 && c<SIZE && boardData[r][c]===color; }
  
  function updateStatus() { 
    if(!gameOver) { 
      let colorText = currPlayer==='black'?'í‘(â—)':'ë°±(â—‹)';
      let colorStyle = currPlayer==='black'?'#fff':'#ccc'; 
      statusEl.innerHTML = `
        <span style="color:${colorStyle}">${colorText}</span> 
        <span class="turn-indicator">ì°¨ë¡€</span>
        <span class="opponent-rank">(ìƒëŒ€: ${level}ë“±ê¸‰)</span>
      `;
    } 
  }
</script>
</body>
</html>
