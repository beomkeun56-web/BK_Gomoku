<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BK GOMOKU : REAL 3D</title>
<style>
  /* 1. ì „ì²´ ë¶„ìœ„ê¸° ë° ë°°ê²½ ì„¤ì • */
  body {
    /* ì–´ë‘¡ê³  ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ìŠ¤íŠœë””ì˜¤ ì¡°ëª… ë¶„ìœ„ê¸° */
    background: radial-gradient(circle at center, #333, #0a0a0a 80%);
    color: #e0e0e0; margin: 0; padding: 20px 0;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    min-height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    touch-action: manipulation; box-sizing: border-box;
  }

  header { 
    width: 92vw; max-width: 480px; margin-bottom: 25px; 
    display: flex; flex-direction: column; align-items: center;
  }
  
  h1 { 
    margin: 0 0 10px 0; font-size: 2.8rem; color: #d4af37; /* í”„ë¦¬ë¯¸ì—„ ê³¨ë“œ */
    letter-spacing: 5px; text-transform: uppercase; font-weight: 300; 
    text-shadow: 0 2px 15px rgba(212, 175, 55, 0.5); /* ê³¨ë“œ ë¹›ë²ˆì§ íš¨ê³¼ */
  }
  
  #status { 
    font-weight: 700; font-size: 1.4rem; color: #fff;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    background: rgba(255,255,255,0.05); padding: 10px 25px; border-radius: 50px;
    backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
  }
  .turn-indicator { font-size: 0.9rem; color: #aaa; font-weight: normal; }
  .opponent-rank {
    font-size: 0.9rem; color: #d4af37; font-weight: normal;
    margin-left: 5px; padding-left: 15px; border-left: 1px solid #444;
  }

  .hidden { display: none !important; }

  /* 2. ë©”ë‰´ í™”ë©´ (ëŸ­ì…”ë¦¬ í…Œë§ˆ) */
  #menu { 
    background: linear-gradient(145deg, #1e1e1e, #0f0f0f); 
    padding: 50px 30px; border-radius: 24px; 
    border: 1px solid #333; margin-top: 5vh;
    box-shadow: 0 30px 80px rgba(0,0,0,0.8); 
    text-align: center; width: 90%; max-width: 400px; 
  }
  #menu h1 { font-size: 3rem; margin-bottom: 5px; }
  .menu-sub { color: #888; margin-bottom: 40px; letter-spacing: 2px; font-size: 0.9rem; }
  .option-group { margin-bottom: 35px; }
  .option-title { font-weight: 600; margin-bottom: 15px; display: block; color: #bbb; font-size: 1rem; letter-spacing: 1px; }
  
  .color-group { display: flex; justify-content: center; gap: 15px; }
  .level-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

  .choice-btn { 
    padding: 15px 0; border: 1px solid #444; 
    background: linear-gradient(to bottom, #2a2a2a, #1a1a1a); color: #999;
    cursor: pointer; border-radius: 14px; 
    font-size: 1rem; font-weight: 600; transition: all 0.2s ease; 
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
  }
  .choice-btn.selected { 
    border-color: #d4af37; background: linear-gradient(to bottom, #d4af37, #aa8c2c); 
    color: #111; text-shadow: 0 1px 0 rgba(255,255,255,0.3);
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5), inset 0 1px 0 rgba(255,255,255,0.4); transform: translateY(-2px);
  }
  
  #start-btn { 
    width: 100%; padding: 20px; 
    background: linear-gradient(to bottom, #d4af37, #aa8c2c); color: #221; 
    border: none; border-radius: 18px; 
    font-size: 1.3rem; font-weight: 800; cursor: pointer; 
    box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4), inset 0 1px 0 rgba(255,255,255,0.4);
    margin-top: 20px; text-shadow: 0 1px 0 rgba(255,255,255,0.3);
  }
  #start-btn:active { transform: scale(0.98); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }

  /* 3. â˜…í•µì‹¬â˜… ë¦¬ì–¼ 3D ë°”ë‘‘íŒ êµ¬í˜„ */
  #game-wrapper {
    position: relative; width: 92vw; height: 92vw;
    max-width: 480px; max-height: 480px;
    
    /* A. ë¦¬ì–¼ ì›ëª© í…ìŠ¤ì²˜ (CSS ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ë‚˜ë¬´ê²° í‘œí˜„) */
    background-color: #cfa36e; /* ê¸°ë³¸ ë‚˜ë¬´ìƒ‰ */
    background-image: 
        /* ë¯¸ì„¸í•œ ë‚˜ë¬´ê²° */
        repeating-linear-gradient(45deg, rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.04) 2px, transparent 2px, transparent 4px),
        /* í° ì˜¹ì´/ê²° ëŠë‚Œ */
        radial-gradient(ellipse at 70% 30%, rgba(100, 70, 40, 0.1) 0%, transparent 60%),
        radial-gradient(ellipse at 30% 70%, rgba(120, 80, 50, 0.1) 0%, transparent 70%);
    
    /* B. ë‘ê»˜ê°ê³¼ ì…ì²´ê°ì„ ë§Œë“œëŠ” í…Œë‘ë¦¬ ë° ê·¸ë¦¼ì */
    border-radius: 6px;
    /* í…Œë‘ë¦¬: ë‘êº¼ìš´ ë‚˜ë¬´ í”„ë ˆì„ ëŠë‚Œ */
    border: 12px solid transparent;
    border-image: linear-gradient(to bottom right, #9e7040, #704a20) 1;
    box-shadow: 
        /* ë‚´ë¶€ë¡œ íŒŒì¸ë“¯í•œ ê¹Šì´ê° */
        inset 0 0 30px rgba(0,0,0,0.4),
        /* ë°”ë‹¥ì— ë‹¿ëŠ” ì§„í•œ ê·¸ë¦¼ì */
        0 20px 40px rgba(0,0,0,0.8),
        /* ì „ì²´ì ìœ¼ë¡œ í¼ì§€ëŠ” ë¹›ë²ˆì§ */
        0 0 100px rgba(212, 175, 55, 0.1);
        
    margin-bottom: 30px; 
    /* ì•½ê°„ì˜ ì›ê·¼ê° (ì„ íƒì‚¬í•­, ëª¨ë°”ì¼ì—ì„œ ê³¼í•˜ë©´ ëº„ ê²ƒ) */
    /* transform: perspective(1000px) rotateX(5deg); */
  }

  /* ê²©ì ë¼ì¸: ë‚˜ë¬´ì— íŒŒì¸ë“¯í•œ ìŒê° íš¨ê³¼ */
  .line { position: absolute; background-color: #4a3525; opacity: 0.9; }
  .h-line { 
    height: 1px; left: 4%; right: 4%; 
    box-shadow: 0 1px 0 rgba(255,255,255,0.1); /* ì•„ë˜ìª½ì— ë°ì€ ì„ ì„ ì¤˜ì„œ íŒŒì¸ ëŠë‚Œ */
  }
  .v-line { 
    width: 1px; top: 4%; bottom: 4%; 
    box-shadow: 1px 0 0 rgba(255,255,255,0.1);
  }
  
  /* í™”ì  */
  .dot { 
    position: absolute; width: 7px; height: 7px; 
    background: #4a3525; border-radius: 50%; 
    transform: translate(-50%, -50%); pointer-events: none; 
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.5), 0 1px 1px rgba(255,255,255,0.2);
  }
  .click-area { position: absolute; transform: translate(-50%, -50%); z-index: 10; cursor: pointer; }

  /* 4. â˜…í•µì‹¬â˜… ê·¹ì‚¬ì‹¤ì£¼ì˜ 3D ë°”ë‘‘ëŒ */
  .stone { 
    position: absolute; border-radius: 50%; 
    transform: translate(-50%, -50%); z-index: 20; 
    pointer-events: none; 
    /* ëŒì´ ë– ë³´ì´ê²Œ ë§Œë“œëŠ” ê¹Šê³  ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    filter: drop-shadow(3px 5px 4px rgba(0,0,0,0.6));
  }
  
  /* í‘ëŒ: ë§¤ëˆí•œ ì˜¤ì„ ëŠë‚Œ (ê°•í•œ í•˜ì´ë¼ì´íŠ¸) */
  .stone.black { 
    /* 3ë‹¨ ê·¸ë¼ë°ì´ì…˜: ë¹›ë°˜ì‚¬ -> ë³¸ì²´ -> ì–´ë‘ìš´ ë°‘ë©´ */
    background: radial-gradient(circle at 30% 30%, #777, #1a1a1a 40%, #000 85%);
    box-shadow: inset 0 -3px 5px rgba(0,0,0,0.8), inset 0 2px 3px rgba(255,255,255,0.3);
  }
  
  /* ë°±ëŒ: ì¡°ê°œ/ì‹ ì†Œì¬ ëŠë‚Œ (ë¶€ë“œëŸ¬ìš´ ë‚œë°˜ì‚¬) */
  .stone.white { 
    background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0 40%, #b0b0b0 85%);
    box-shadow: inset 0 -3px 5px rgba(0,0,0,0.2), inset 0 2px 3px rgba(255,255,255,0.8);
  }

  /* ë§ˆì§€ë§‰ ìˆ˜ í‘œì‹œ (ë¶‰ì€ìƒ‰ ë³´ì„ íš¨ê³¼) */
  .last-move::after { 
    content: ''; position: absolute; top: 50%; left: 50%; width: 22%; height: 22%; 
    border-radius: 50%; transform: translate(-50%, -50%); 
    background: radial-gradient(circle at 30% 30%, #ff6b6b, #ff0000);
    box-shadow: 0 0 10px #ff0000, inset 0 1px 3px rgba(255,255,255,0.5);
  }

  /* í›ˆìˆ˜ ë§ˆì»¤ (ë¹›ë‚˜ëŠ” ë§) */
  .hint-marker {
    position: absolute; 
    border: 3px solid rgba(212, 175, 55, 0.8); 
    border-radius: 50%; transform: translate(-50%, -50%); z-index: 15;
    pointer-events: none; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8), inset 0 0 10px rgba(212, 175, 55, 0.5);
    animation: pulse 1.5s infinite ease-in-out;
  }
  @keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.6; }
    50% { transform: translate(-50%, -50%) scale(1.15); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.6; }
  }

  /* 5. í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë°” (ê³¨ë“œ & ë©”íƒˆ) */
  .control-bar {
    width: 92vw; max-width: 480px;
    display: flex; justify-content: space-between; gap: 15px; margin-bottom: 20px;
  }
  .game-btn {
    flex: 1; padding: 16px 0; border-radius: 14px;
    font-size: 1.1rem; font-weight: 700;
    cursor: pointer; transition: all 0.15s;
    display: flex; justify-content: center; align-items: center; gap: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.1);
  }
  
  #hint-btn { 
    background: linear-gradient(135deg, #333, #222); color: #d4af37; border-color: #d4af37;
  }
  #hint-btn:active { background: #d4af37; color: #000; transform: translateY(2px); }
  
  #undo-btn { 
    background: linear-gradient(135deg, #2c2c2e, #1c1c1e); color: #ccc; 
  }
  #undo-btn:active { background: #eee; color: #000; transform: translateY(2px); }
  
  #exit-btn {
    width: 92vw; max-width: 480px; padding: 15px 0;
    background: transparent; border: 2px solid #333; color: #888;
    border-radius: 14px; font-size: 1rem; cursor: pointer; font-weight: 600;
    margin-bottom: 30px; transition: all 0.2s;
  }
  #exit-btn:hover { border-color: #555; color: #aaa; }
  #exit-btn:active { background: #333; color: #fff; }

</style>
</head>
<body>

<div id="menu">
  <h1>BK GOMOKU</h1>
  <div class="menu-sub">THE REAL 3D EDITION</div>
  
  <div class="option-group">
    <span class="option-title">ë‚´ ëŒ ì„ íƒ</span>
    <div class="color-group">
      <button class="choice-btn selected" style="flex:1;" onclick="setOpt('color','black',this)">í‘(â—)</button>
      <button class="choice-btn" style="flex:1;" onclick="setOpt('color','white',this)">ë°±(â—‹)</button>
    </div>
  </div>

  <div class="option-group">
    <span class="option-title">AI ë‚œì´ë„ (ì‚¬ëŒê°™ì€ ë°¸ëŸ°ìŠ¤)</span>
    <div class="level-grid">
      <button class="choice-btn" onclick="setOpt('level',1,this)">1ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',2,this)">2ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',3,this)">3ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',4,this)">4ë“±ê¸‰</button>
      <button class="choice-btn" onclick="setOpt('level',5,this)">5ë“±ê¸‰</button>
      <button class="choice-btn selected" onclick="setOpt('level',6,this)">6ë“±ê¸‰</button>
    </div>
  </div>
  
  <button id="start-btn" onclick="startGame()" ontouchstart="startGame()">ëŒ€êµ­ ì‹œì‘</button>
</div>

<div id="game" class="hidden">
  <header>
    <h1>BK GOMOKU</h1>
    <div id="status"></div>
  </header>

  <div id="game-wrapper"></div>

  <div class="control-bar">
    <button id="hint-btn" class="game-btn" onclick="showHint()">âœ¨ í›ˆìˆ˜ ë³´ê¸°</button>
    <button id="undo-btn" class="game-btn" onclick="undoMove()">â†© ë¬´ë¥´ê¸°</button>
  </div>
  <button id="exit-btn" onclick="goBackToMenu()">ë©”ë‰´ë¡œ ë‚˜ê°€ê¸°</button>
</div>

<script>
  // =================================================================
  // [ë¡œì§ì€ ê¸°ì¡´ Human-like Balance ë²„ì „ê³¼ ì™„ì „íˆ ë™ì¼í•©ë‹ˆë‹¤]
  // ë””ìì¸(CSS)ë§Œ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ, ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
  // =================================================================
  const SIZE = 15;
  const PADDING = 5.5; // 3D í”„ë ˆì„ ë‘ê»˜ ê³ ë ¤ ì—¬ë°± ì¡°ì •
  const ACTIVE_WIDTH = 100 - (PADDING * 2);
  const STEP = ACTIVE_WIDTH / (SIZE - 1);
  const STONE_SIZE = STEP * 0.92; // ëŒ í¬ê¸° ìµœì í™”

  let boardData = [], myColor = 'black', aiColor = 'white', level = 6, currPlayer = 'black', gameOver = false;
  let moveHistory = []; 
  let aiTimer = null;   
  let audioCtx = null;

  function initAudio() {
    try {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
    } catch(e) {}
  }

  function playClickSound() {
    try {
      if (!audioCtx) return; 
      // ë” ë¬µì§í•˜ê³  ìš¸ë¦¬ëŠ” ì°©ìˆ˜ìŒìœ¼ë¡œ ë³€ê²½
      const bufferSize = audioCtx.sampleRate * 0.15; 
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize/4));
      
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      
      const filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = 600; // ë” ë‚®ì€ ì£¼íŒŒìˆ˜ë¡œ ë¬µì§í•˜ê²Œ
      
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.8, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
      
      noise.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
      noise.start();
    } catch(e) {}
  }

  const wrapper = document.getElementById('game-wrapper');
  const statusEl = document.getElementById('status');
  const menuEl = document.getElementById('menu');
  const gameEl = document.getElementById('game');

  function getPos(idx) { return PADDING + (idx * STEP); }

  function setOpt(type, val, btn) {
    if(window.event) window.event.stopPropagation();
    if(type==='color') { myColor=val; aiColor=(val==='black'?'white':'black'); }
    if(type==='level') level = parseInt(val);
    let container = btn.parentElement;
    container.querySelectorAll('.choice-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
  }

  function startGame() {
    if(window.event) window.event.preventDefault();
    initAudio();

    menuEl.classList.add('hidden');
    gameEl.classList.remove('hidden');
    boardData = Array(SIZE).fill(null).map(() => Array(SIZE).fill(null));
    wrapper.innerHTML = '';
    
    currPlayer = 'black'; 
    gameOver = false; 
    moveHistory = []; 
    if(aiTimer) clearTimeout(aiTimer);
    
    updateStatus();

    // ê²©ì ê·¸ë¦¬ê¸°
    for(let i=0; i<SIZE; i++) {
      let pos = getPos(i) + '%';
      let h = document.createElement('div'); h.className='line h-line'; h.style.top=pos; wrapper.appendChild(h);
      let v = document.createElement('div'); v.className='line v-line'; v.style.left=pos; wrapper.appendChild(v);
    }
    // í™”ì 
    [3, 7, 11].forEach(r => [3, 7, 11].forEach(c => {
      let dot = document.createElement('div'); dot.className='dot';
      dot.style.top=getPos(r)+'%'; dot.style.left=getPos(c)+'%'; wrapper.appendChild(dot);
    }));
    // í´ë¦­ ì˜ì—­
    for(let r=0; r<SIZE; r++) {
      for(let c=0; c<SIZE; c++) {
        let area = document.createElement('div'); area.className='click-area';
        area.style.width = STEP + '%'; area.style.height = STEP + '%';
        area.style.top=getPos(r)+'%'; area.style.left=getPos(c)+'%';
        area.onclick = () => userMove(r, c);
        wrapper.appendChild(area);
      }
    }
    
    if(myColor === 'white') {
        aiTimer = setTimeout(aiMove, 600);
    }
  }

  function goBackToMenu() {
    gameEl.classList.add('hidden'); menuEl.classList.remove('hidden'); wrapper.innerHTML = '';
  }

  function userMove(r, c) {
    if(gameOver || currPlayer !== myColor || boardData[r][c]) return;
    placeStone(r, c, myColor);
    removeHint();
    if(!gameOver) { 
      currPlayer = aiColor; updateStatus(); 
      aiTimer = setTimeout(aiMove, 500); 
    }
  }

  function placeStone(r, c, color) {
    boardData[r][c] = color;
    let prevLast = document.querySelector('.last-move');
    if(prevLast) prevLast.classList.remove('last-move');
    
    let stone = document.createElement('div');
    stone.className = `stone ${color} last-move`;
    stone.style.width = STONE_SIZE + '%';
    stone.style.height = STONE_SIZE + '%';
    stone.style.top = getPos(r) + '%';
    stone.style.left = getPos(c) + '%';
    wrapper.appendChild(stone);
    
    moveHistory.push({r, c, color, el: stone});
    playClickSound();
    
    if(checkWin(r, c, color)) {
      gameOver = true;
      let winText = (color==='black'?"í‘(â—) ìŠ¹ë¦¬!":"ë°±(â—‹) ìŠ¹ë¦¬!");
      statusEl.innerHTML = `<span style="color:#d4af37; text-shadow:0 0 10px gold;">ğŸ† ${winText}</span>`;
      setTimeout(()=>alert(winText), 200);
    }
  }

  function aiMove() {
    if(gameOver) return;
    let bm = computeBestMove(aiColor, level); 
    placeStone(bm.r, bm.c, aiColor);
    if(!gameOver) { currPlayer = myColor; updateStatus(); }
  }

  function undoMove() {
    if(moveHistory.length === 0) return;
    if(aiTimer) clearTimeout(aiTimer);
    removeHint(); gameOver = false;
    
    let lastMove = moveHistory[moveHistory.length-1];
    if (lastMove.color === aiColor) { 
        popStone(); 
        if(moveHistory.length > 0) popStone(); 
    } else { 
        popStone(); 
    }
    
    currPlayer = myColor; updateStatus();
    
    let prevLast = document.querySelector('.last-move');
    if(prevLast) prevLast.classList.remove('last-move'); 
    if(moveHistory.length > 0) {
        moveHistory[moveHistory.length-1].el.classList.add('last-move');
    }
  }

  function popStone() {
    let item = moveHistory.pop();
    boardData[item.r][item.c] = null; 
    item.el.remove(); 
  }

  function showHint() {
    if(gameOver) return;
    removeHint();
    let best = computeBestMove(currPlayer, 0); // 0 = í›ˆìˆ˜
    let marker = document.createElement('div');
    marker.className = 'hint-marker';
    marker.style.width = STONE_SIZE + '%';
    marker.style.height = STONE_SIZE + '%';
    marker.style.top = getPos(best.r) + '%';
    marker.style.left = getPos(best.c) + '%';
    wrapper.appendChild(marker);
  }

  function removeHint() {
    let exist = document.querySelector('.hint-marker');
    if(exist) exist.remove();
  }

  function getLineStr(r, c, dr, dc, color) {
    let str = "";
    for(let k=-4; k<=4; k++) {
      let nr = r + dr*k, nc = c + dc*k;
      if(nr<0||nr>=SIZE||nc<0||nc>=SIZE) str += "2"; 
      else {
        let val = boardData[nr][nc];
        if(val === null) str += "0";
        else if(val === color) str += "1";
        else str += "2"; 
      }
    }
    return str;
  }

  // [AI ë¡œì§ ìœ ì§€]
  function computeBestMove(atkColor, lv) {
    let defColor = (atkColor === 'black' ? 'white' : 'black');
    let maxS = -Infinity, cands = [];
    let center = 7;
    let defW = 1.0; 
    
    switch(lv) {
        case 0: defW = 1.5; break; 
        case 1: defW = 1.0; break; 
        case 2: defW = 0.8; break; 
        case 3: defW = 0.6; break; 
        case 4: defW = 0.4; break; 
        case 5: defW = 0.2; break; 
        case 6: defW = 0.05; break;
    }

    for(let r=0; r<SIZE; r++) {
      for(let c=0; c<SIZE; c++) {
        if(boardData[r][c]) continue;
        let atkScore = getPatternScore(r, c, atkColor);
        let defScore = getPatternScore(r, c, defColor);
        let total = atkScore + (defScore * defW); 
        total -= (Math.abs(r-center) + Math.abs(c-center)); 
        if(lv !== 0) total += Math.random() * 5; 
        if(total > maxS) { maxS=total; cands=[{r,c}]; }
        else if(total === maxS) cands.push({r,c});
      }
    }
    return cands.length ? cands[Math.floor(Math.random()*cands.length)] : {r:7,c:7};
  }

  function getPatternScore(r, c, stoneColor) {
    let totalScore = 0;
    const directions = [[0,1], [1,0], [1,1], [1,-1]];
    directions.forEach(d => {
      let lineStr = getLineStr(r, c, d[0], d[1], stoneColor);
      if(lineStr.includes("11111")) totalScore += 100000000;
      else if(lineStr.includes("011110")) totalScore += 10000000;
      else if(lineStr.includes("01111") || lineStr.includes("11110")) totalScore += 500000;
      else if(lineStr.includes("01110") || lineStr.includes("010110") || lineStr.includes("011010")) totalScore += 200000;
      else if(lineStr.includes("1110") || lineStr.includes("0111")) totalScore += 5000;
      else if(lineStr.includes("0110") || lineStr.includes("01010")) totalScore += 3000;
      else if(lineStr.includes("11")) totalScore += 100;
    });
    return totalScore;
  }

  function checkWin(r, c, color) {
    return [[0,1],[1,0],[1,1],[1,-1]].some(d => {
      let cnt = 1;
      for(let k=1; k<6; k++) if(isValid(r+d[0]*k, c+d[1]*k, color)) cnt++; else break;
      for(let k=1; k<6; k++) if(isValid(r-d[0]*k, c-d[1]*k, color)) cnt++; else break;
      return cnt >= 5;
    });
  }
  function isValid(r, c, color) { return r>=0 && r<SIZE && c>=0 && c<SIZE && boardData[r][c]===color; }
  
  function updateStatus() { 
    if(!gameOver) { 
      let colorText = currPlayer==='black'?'í‘(â—)':'ë°±(â—‹)';
      let colorStyle = currPlayer==='black'?'#fff':'#ccc'; 
      statusEl.innerHTML = `
        <span style="color:${colorStyle}">${colorText}</span> 
        <span class="turn-indicator">ì°¨ë¡€</span>
        <span class="opponent-rank">(ìƒëŒ€: ${level}ë“±ê¸‰)</span>
      `;
    } 
  }
</script>
</body>
</html>
